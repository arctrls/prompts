# CN 상점 구매제한수량 도메인 룰

## 🎯 공통 적용 조건

### **기본 조건**
- CN 상점(197번)
- 배송지가 중국이면서 배송방법이 bros(yto)인 경우

### **수량 계산 기준 (알맹이 상품만 계산)**
```
카운트 대상: TUBE_YN != 'Y' AND GIFTS_KIND_CD == null
계산 공식: totGoodsCnt = QTY × GOODS_PACK_CNT
GOODS_PACK_CNT: 패키지 안의 실제 상품 개수 (null인 경우 1로 처리)
```

---

## 📋 제한 수량 적용 방식

### **상점 제한 수량**
- 하나의 주문에서는 상품을 10개까지만 구매할 수 있다 (그룹 설정 여부와 무관)

### **상품 그룹 제한 수량**
- 상품 그룹에 속한 모든 상품의 수량 합계가 그룹별 제한 수량을 초과할 수 없다

---

## 🎯 시나리오 예시

### **Case 1: 상점 제한 수량만 적용**
**✅ 성공 케이스**
```
주문: A1(그룹 미설정) 5개 + A2(그룹 미설정) 3개 = 8개
상점 제한: 10개 ✅ (8 ≤ 10)
결과: ✅ 구매 가능
```

**❌ 실패 케이스**
```
주문: A1(그룹 미설정) 7개 + A2(그룹 미설정) 5개 = 12개
상점 제한: 10개 ❌ (12 > 10)
결과: ❌ 구매 불가 (상점 제한 수량 초과)
```

### **Case 2: 단일 그룹 + 상점 제한 (상점 제한이 더 큰 경우)**
**✅ 성공 케이스**
```
주문: A1(그룹1) 3개 + A2(그룹1) 2개 = 5개
그룹1 제한: 7개 ✅ (5 ≤ 7)
상점 제한: 10개 ✅ (5 ≤ 10)
결과: ✅ 구매 가능
```

**❌ 실패 케이스**
```
주문: A1(그룹1) 5개 + A2(그룹1) 4개 = 9개
그룹1 제한: 7개 ❌ (9 > 7)
상점 제한: 10개 (검증 전 차단)
결과: ❌ 구매 불가 (그룹 제한 수량 초과)
```

### **Case 3: 단일 그룹 + 상점 제한 (상점 제한이 더 작은 경우)**
**✅ 성공 케이스**
```
주문: A1(그룹1) 8개 + A2(그룹1) 4개 = 12개
그룹1 제한: 20개 ✅ (12 ≤ 20)
상점 제한: 단일 그룹의 경우, 그룹 제한 수량만 적용
결과: ✅ 구매 가능
```

**❌ 실패 케이스**
```
주문: A1(그룹1) 4개 + A2(그룹1) 2개 = 6개
그룹1 제한: 4 개 ✅ (6 ≤ 4)
상점 제한: 단일 그룹의 경우, 그룹 제한 수량만 적용
결과: ❌ 구매 불가 (그룹 제한 수량 초과)
```

### **Case 4: 다중 그룹 + 상점 제한 (상점 제한이 더 큰 경우)**
**✅ 성공 케이스**
```
주문: A1(그룹1) 2개 + B1(그룹2) 3개 = 5개
그룹1 제한: 3개 ✅ (2 ≤ 3)
그룹2 제한: 4개 ✅ (3 ≤ 4)
상점 제한: 10개 ✅ (5 ≤ 10)
결과: ✅ 구매 가능
```

**❌ 실패 케이스**
```
주문: A1(그룹1) 4개 + B1(그룹2) 3개 = 7개
그룹1 제한: 3개 ❌ (4 > 3)
그룹2 제한: 4개 (검증 전 차단)
상점 제한: 10개 (검증 전 차단)
결과: ❌ 구매 불가 (그룹1 제한 수량 초과)
```

### **Case 5: 다중 그룹 + 상점 제한 (상점 제한이 더 작은 경우)**
**✅ 성공 케이스**
```
주문: A1(그룹1) 3개 + B1(그룹2) 5개 = 8개
그룹1 제한: 15개 ✅ (3 ≤ 15)
그룹2 제한: 20개 ✅ (5 ≤ 20)
상점 제한: 10개 ✅ (8 ≤ 10)
결과: ✅ 구매 가능 (상점 제한이 더 제한적)
```

**❌ 실패 케이스**
```
주문: A1(그룹1) 5개 + B1(그룹2) 7개 = 12개
그룹1 제한: 15개 ✅ (5 ≤ 15)
그룹2 제한: 20개 ✅ (7 ≤ 20)
상점 제한: 10개 ❌ (12 > 10)
결과: ❌ 구매 불가 (상점 제한 수량 초과)
```
